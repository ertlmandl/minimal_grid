// -----------------------------------------------------------------------------
// TYPOGRAPHY (viewport-first + container opt-in)
// -----------------------------------------------------------------------------
//
// Kurz, robust, lesbar. Viewport-basiert per clamp().
// Optional: .typo-container schaltet identische Skala auf Container-Basis (cqi).
//
// -----------------------------------------------------------------------------
// TYPOGRAPHY CONFIG OVERVIEW
// -----------------------------------------------------------------------------
// • $font-sans ............ Basis-Schriftfamilie
// • $vw-min / $vw-max ..... Viewport-Range für Fluid Scale
// • $cq-min / $cq-max ..... Container-Range (für .typo-container)
// • $heading-size-mode .... globaler Heading-Faktor (large|normal|small)
// • $heading-scales-override ... Feinanpassung einzelner Headings
// -----------------------------------------------------------------------------

// -----------------------------------------------------------------------------
// IMPORTS
// -----------------------------------------------------------------------------

@use "sass:map";
@use "sass:math";
@use "sass:string";

// -----------------------------------------------------------------------------
// 1) PROJECT SETTINGS – Passe hier an
// -----------------------------------------------------------------------------

// 1. Schriftfamilie
$font-sans: "Inter", system-ui, sans-serif !default;

// 2. Min/Max Referenzen für Fluid-Skala (Viewport)
$vw-min: 360px !default;
$vw-max: 1440px !default;

// 3. Container-Min/Max (für .typo-container)
$cq-min: 320px !default;
$cq-max: 1200px !default;

// 4. Headings globaler Größenmodus
$heading-size-mode: large !default; // large | normal | small

// 5. Optionale, gezielte Projekt-Overrides (kombinierbar mit Mode)
$heading-scales-override: () !default;

// -----------------------------------------------------------------------------
// 2) DESIGN SYSTEM DEFAULTS – meist unverändert
// -----------------------------------------------------------------------------

// Typo-Stufen (min/max in PX) – bewusst schlanke Skala
$type-steps: (
  -2: (min: 12px, max: 14px),
  -1: (min: 14px, max: 16px),
   0: (min: 16px, max: 18px),
   1: (min: 20px, max: 24px),
   2: (min: 26px, max: 32px),
   3: (min: 32px, max: 40px)
) !default;

$heading-scales-presets: (
  large:  (h1: 1.35, h2: 1.28, h3: 1.22, h4: 1.14, h5: 1.00, h6: 0.90),
  normal: (h1: 1.00, h2: 1.00, h3: 1.00, h4: 1.00, h5: 1.00, h6: 1.00),
  small:  (h1: 0.88, h2: 0.92, h3: 0.95, h4: 0.97, h5: 0.98, h6: 1.00)
) !default;

// -----------------------------------------------------------------------------
// 3) SYSTEM LOGIC (intern)
// -----------------------------------------------------------------------------

@function fluid-token($min, $max, $axis-min, $axis-max, $unit) {
  // CSS calc() kann nur durch einheitslose Zahlen teilen → Zahlen extrahieren
  $min-val: $min;
  $max-val: $max;

  $range-unitless: math.div($max - $min, 1px);
  $axis-min-unitless: math.div($axis-min, 1px);
  $axis-range-unitless: math.div($axis-max - $axis-min, 1px);

  // clamp(min, min + range * ((100<unit> - axis-min) / axis-range), max)
  @return string.unquote(
    "clamp(#{$min-val}, calc(#{$min-val} + #{$range-unitless} * ((100#{$unit} - #{$axis-min-unitless}px) / #{$axis-range-unitless})), #{$max-val})"
  );
}

@mixin define-fluid-steps($steps, $axis-min, $axis-max, $unit) {
  @each $k, $pair in $steps {
    $min: map.get($pair, min);
    $max: map.get($pair, max);
    --fs-#{$k}: #{fluid-token($min, $max, $axis-min, $axis-max, $unit)};
  }
}

// -----------------------------------------------------------------------------
// 4) ROOT: Viewport-basierte Skala (Default)
// -----------------------------------------------------------------------------

:root {
  // Leselängen & Rhythmus
  --measure: 65ch;
  --lead: 1.5;    // default line-height
  --lead-tight: 1.2;
  --lead-loose: 1.7;

  // Viewport-basierte Font-Size Tokens (vw = viewport width)
  @include define-fluid-steps($type-steps, $vw-min, $vw-max, vw);
}

// -----------------------------------------------------------------------------
// 5) BASE ELEMENTS
// -----------------------------------------------------------------------------

html { -webkit-text-size-adjust: 100%; }

body {
  margin: 0;
  font-family: $font-sans;
  font-size: var(--fs-0);
  line-height: var(--lead);
  text-rendering: optimizeLegibility;
}

@supports (text-wrap: balance) {
  h1, h2, h3 { text-wrap: balance; }
}

.prose {
  max-width: var(--measure);
}

p, ul, ol, blockquote, pre { margin: 0 0 1em 0; }

small, .small { font-size: var(--fs--1); line-height: var(--lead); }
.lead    { font-size: var(--fs-1);  line-height: var(--lead-loose); }
.kicker  { font-size: var(--fs--1); letter-spacing: .04em; text-transform: uppercase; }

// Optional: optische Absatztrennung
hr {
  border: 0;
  height: 1px;
  background: currentColor;
  opacity: .15;
  margin: 2em 0;
}

// -----------------------------------------------------------------------------
// 6) HEADINGS (Tokens + skalierbare Presets)
// -----------------------------------------------------------------------------

@function _heading-scales() {
  $preset: map.get($heading-scales-presets, $heading-size-mode);
  @return map.merge($preset, $heading-scales-override);
}

$__h-scales: _heading-scales();

h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
  line-height: var(--lead-tight);
  margin: 0 0 0.6em 0;
}

// Skaliert fluid via clamp-Tokens + Faktor
h1 { font-size: calc(var(--fs-3)  * #{map.get($__h-scales, h1)}); }
h2 { font-size: calc(var(--fs-2)  * #{map.get($__h-scales, h2)}); }
h3 { font-size: calc(var(--fs-1)  * #{map.get($__h-scales, h3)}); }
h4 { font-size: calc(var(--fs-0)  * #{map.get($__h-scales, h4)}); }
h5 { font-size: calc(var(--fs--1) * #{map.get($__h-scales, h5)}); }
h6 { font-size: calc(var(--fs--2) * #{map.get($__h-scales, h6)}); }

// -----------------------------------------------------------------------------
// 7) CONTAINER-BASED TYPO: .typo-container
// -----------------------------------------------------------------------------
//
// Aktiviert container-basierte Skala mit identischen Stufen,
// gesteuert über cqi (Container Inline Size).
// Fallback: Wenn cqi nicht verfügbar ist oder kein Container existiert,
// verhalten sich cq* laut Spezifikation wie kleine Viewport-Units (sv*).
// -----------------------------------------------------------------------------

.typo-container {
  // macht dieses Element zu einem Abfrage-Container
  container-type: inline-size;

  // Default: erbt Root-Tokens (Viewport). Wenn cqi verfügbar, überschreiben:
  @supports (width: 1cqi) {
    @include define-fluid-steps($type-steps, $cq-min, $cq-max, cqi);
  }
}

// -----------------------------------------------------------------------------
// 8) UTILS (leichtgewichtige Lesbarkeitshilfen)
// -----------------------------------------------------------------------------

.measure { max-width: var(--measure); }
.nowrap  { white-space: nowrap; }
.hyphens { hyphens: auto; }
.tight   { line-height: var(--lead-tight); }
.loose   { line-height: var(--lead-loose); }

// Optional: Schriftgrößen als Utilities – entspricht Token-Namen
.fs--2 { font-size: var(--fs--2); }
.fs--1 { font-size: var(--fs--1); }
.fs-0  { font-size: var(--fs-0);  }
.fs-1  { font-size: var(--fs-1);  }
.fs-2  { font-size: var(--fs-2);  }
.fs-3  { font-size: var(--fs-3);  }
